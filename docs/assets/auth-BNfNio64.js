import{j as n,S as D}from"./ui-vendor-CRP0iqJy.js";import{r as f}from"./react-vendor-DWv6uwxK.js";import{c as C,t as T}from"./utils-vendor-BZaDkFqu.js";import{c as G}from"./supabase-vendor-B9YYga7y.js";const j="https://cikoqlryskuczwtfkprq.supabase.co",_="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNpa29xbHJ5c2t1Y3p3dGZrcHJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMzNzIwODcsImV4cCI6MjA2ODk0ODA4N30.O_DML3t7yZOAJ7LcIqnPSuWCo7_DpeAcqxxIN38TUd8",g=G(j,_),M=async()=>{try{console.log("Testing Supabase connection..."),console.log("URL:",j),console.log("Key:",_?.substring(0,20)+"...");const{data:e,error:r}=await g.from("users").select("count").limit(1);return console.log("Connection test result:",{data:e,error:r}),{success:!r,error:r}}catch(e){return console.error("Connection test failed:",e),{success:!1,error:e}}},h={async signUp(e,r,t){if(!["ivanaguilarmari@gmail.com","youssef.dummy@test.com"].includes(e.toLowerCase()))throw new Error("This app is currently limited to Ivan and Youssef only. Contact Ivan if you need access.");const{data:a,error:c}=await g.auth.signUp({email:e,password:r,options:{data:{name:t}}});if(c)throw c;return a},async signIn(e,r){if(console.log("authService.signIn called with:",e),!["ivanaguilarmari@gmail.com","youssef.dummy@test.com"].includes(e.toLowerCase()))throw new Error("This app is currently limited to Ivan and Youssef only. Contact Ivan if you need access.");try{const{data:s,error:a}=await g.auth.signInWithPassword({email:e,password:r});if(console.log("Supabase signIn response:",{data:s,error:a}),a)throw a;return s}catch(s){throw console.error("authService.signIn error:",s),s}},async signInWithGoogle(){const{data:e,error:r}=await g.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/auth/callback`}});if(r)throw r;return e},async signOut(){const{error:e}=await g.auth.signOut();if(e)throw e},async getSession(){const{data:{session:e},error:r}=await g.auth.getSession();if(r)throw r;return e},async getUser(){const{data:{user:e},error:r}=await g.auth.getUser();if(r)throw r;return e},onAuthStateChange(e){return g.auth.onAuthStateChange(e)},async createUserProfile(e){console.log("Creating user profile for:",e.email);const r={id:e.id,email:e.email,name:e.user_metadata?.name||e.email.split("@")[0],avatar:e.user_metadata?.avatar_url,preferences:{notifications:{sms:!0,push:!0,reminder_time:30}},stats:{total_sessions:0,current_streak:0,badges:[]}};try{const t=new Promise((v,o)=>setTimeout(()=>o(new Error("Database insert timeout")),3e3)),s=g.from("users").insert(r).select().single(),{data:a,error:c}=await Promise.race([s,t]);if(console.log("createUserProfile result:",{data:a,error:c}),c)return console.error("Failed to create user profile in database:",c),{id:e.id,email:e.email,name:e.user_metadata?.name||e.email.split("@")[0],avatar:e.user_metadata?.avatar_url,partnerId:void 0,preferences:{notifications:{sms:!0,push:!0,reminderTime:30}},stats:{totalSessions:0,currentStreak:0,badges:[]}};if(!a)throw new Error("Failed to create user profile - no data returned");return{id:a.id,email:a.email,name:a.name,avatar:a.avatar,phoneNumber:a.phone_number,partnerId:a.partner_id,preferences:{notifications:{sms:a.preferences?.notifications?.sms??!0,push:a.preferences?.notifications?.push??!0,reminderTime:a.preferences?.notifications?.reminder_time??30}},stats:{totalSessions:a.stats?.total_sessions??0,currentStreak:a.stats?.current_streak??0,badges:a.stats?.badges??[]}}}catch(t){return console.error("createUserProfile error:",t),{id:e.id,email:e.email,name:e.user_metadata?.name||e.email.split("@")[0],avatar:e.user_metadata?.avatar_url,partnerId:void 0,preferences:{notifications:{sms:!0,push:!0,reminderTime:30}},stats:{totalSessions:0,currentStreak:0,badges:[]}}}},async getUserProfile(e){console.log("getUserProfile called for userId:",e);try{const r=new Promise((v,o)=>setTimeout(()=>o(new Error("Database query timeout")),3e3)),t=g.from("users").select("*").eq("id",e).maybeSingle(),{data:s,error:a}=await Promise.race([t,r]);if(console.log("getUserProfile result:",{data:s,error:a}),console.log("Data details:",s),a)return console.error("Database error:",a),null;if(!s)return console.log("No user profile found - will create one"),null;console.log("Found user profile, converting to camelCase...");const c={id:s.id,email:s.email,name:s.name,avatar:s.avatar,phoneNumber:s.phone_number,partnerId:s.partner_id,preferences:{notifications:{sms:s.preferences?.notifications?.sms??!0,push:s.preferences?.notifications?.push??!0,reminderTime:s.preferences?.notifications?.reminder_time??30}},stats:{totalSessions:s.stats?.total_sessions??0,currentStreak:s.stats?.current_streak??0,badges:s.stats?.badges??[]}};return console.log("Converted profile:",c),c}catch(r){return console.error("getUserProfile error:",r),null}},async updateUserProfile(e,r){const t={updated_at:new Date().toISOString()};r.name!==void 0&&(t.name=r.name),r.avatar!==void 0&&(t.avatar=r.avatar),r.phoneNumber!==void 0&&(t.phone_number=r.phoneNumber),r.partnerId!==void 0&&(t.partner_id=r.partnerId),r.preferences!==void 0&&(t.preferences=r.preferences),r.stats!==void 0&&(t.stats=r.stats);const{data:s,error:a}=await g.from("users").update(t).eq("id",e).select().single();if(a)throw a;return{id:s.id,email:s.email,name:s.name,avatar:s.avatar,phoneNumber:s.phone_number,partnerId:s.partner_id,preferences:s.preferences,stats:s.stats}}};function z(){const[e,r]=f.useState({user:null,profile:null,loading:!0,error:null});return f.useEffect(()=>{let o=!0;(async()=>{try{const l=await h.getSession();if(!o)return;if(l?.user){const m=await h.getUserProfile(l.user.id);if(!o)return;r({user:l.user,profile:m,loading:!1,error:null})}else r({user:null,profile:null,loading:!1,error:null})}catch(l){if(console.error("Auth error:",l),!o)return;r({user:null,profile:null,loading:!1,error:l instanceof Error?l.message:"An error occurred"})}})();const{data:{subscription:i}}=h.onAuthStateChange(async(l,m)=>{if(console.log("Auth state changed:",l,m?.user?.email),!!o)try{if(m?.user){console.log("Auth listener: Getting profile for user...");let u=await h.getUserProfile(m.user.id);console.log("Auth listener: Got profile:",u),!u&&l==="SIGNED_IN"&&(console.log("Creating new user profile..."),u=await h.createUserProfile(m.user)),console.log("Auth listener: Setting state with user and profile"),r({user:m.user,profile:u,loading:!1,error:null}),console.log("Auth listener: State updated successfully")}else console.log("Auth listener: No user, clearing state"),r({user:null,profile:null,loading:!1,error:null})}catch(u){console.error("Auth state change error:",u),r({user:null,profile:null,loading:!1,error:u instanceof Error?u.message:"An error occurred"})}});return()=>{o=!1,i.unsubscribe()}},[]),{...e,signUp:async(o,d,i)=>{r(l=>({...l,loading:!0,error:null}));try{await h.signUp(o,d,i)}catch(l){throw r(m=>({...m,loading:!1,error:l instanceof Error?l.message:"Sign up failed"})),l}},signIn:async(o,d)=>{console.log("useAuth signIn called");try{const i=await h.signIn(o,d);console.log("Sign in result:",i)}catch(i){throw console.error("useAuth signIn error:",i),r(l=>({...l,loading:!1,error:i instanceof Error?i.message:"Sign in failed"})),i}},signInWithGoogle:async()=>{r(o=>({...o,loading:!0,error:null}));try{await h.signInWithGoogle()}catch(o){throw r(d=>({...d,loading:!1,error:o instanceof Error?o.message:"Google sign in failed"})),o}},signOut:async()=>{r(o=>({...o,loading:!0,error:null}));try{await h.signOut()}catch(o){throw r(d=>({...d,loading:!1,error:o instanceof Error?o.message:"Sign out failed"})),o}},updateProfile:async o=>{if(!e.user)throw new Error("No user logged in");r(d=>({...d,loading:!0,error:null}));try{const d=await h.updateUserProfile(e.user.id,o);return r(i=>({...i,profile:d,loading:!1,error:null})),d}catch(d){throw r(i=>({...i,loading:!1,error:d instanceof Error?d.message:"Profile update failed"})),d}},isAuthenticated:!!e.user}}const N=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,S=C,F=(e,r)=>t=>{var s;if(r?.variants==null)return S(e,t?.class,t?.className);const{variants:a,defaultVariants:c}=r,v=Object.keys(a).map(i=>{const l=t?.[i],m=c?.[i];if(l===null)return null;const u=N(l)||N(m);return a[i][u]}),o=t&&Object.entries(t).reduce((i,l)=>{let[m,u]=l;return u===void 0||(i[m]=u),i},{}),d=r==null||(s=r.compoundVariants)===null||s===void 0?void 0:s.reduce((i,l)=>{let{class:m,className:u,...p}=l;return Object.entries(p).every(O=>{let[I,x]=O;return Array.isArray(x)?x.includes({...c,...o}[I]):{...c,...o}[I]===x})?[...i,m,u]:i},[]);return S(e,v,d,t?.class,t?.className)};function y(...e){return T(C(e))}const V=F("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),b=f.forwardRef(({className:e,variant:r,size:t,asChild:s=!1,...a},c)=>{const v=s?D:"button";return n.jsx(v,{className:y(V({variant:r,size:t,className:e})),ref:c,...a})});b.displayName="Button";const w=f.forwardRef(({className:e,type:r,...t},s)=>n.jsx("input",{type:r,className:y("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:s,...t}));w.displayName="Input";const A=f.forwardRef(({className:e,...r},t)=>n.jsx("div",{ref:t,className:y("rounded-xl border bg-card text-card-foreground shadow",e),...r}));A.displayName="Card";const P=f.forwardRef(({className:e,...r},t)=>n.jsx("div",{ref:t,className:y("flex flex-col space-y-1.5 p-6",e),...r}));P.displayName="CardHeader";const U=f.forwardRef(({className:e,...r},t)=>n.jsx("div",{ref:t,className:y("font-semibold leading-none tracking-tight",e),...r}));U.displayName="CardTitle";const E=f.forwardRef(({className:e,...r},t)=>n.jsx("div",{ref:t,className:y("text-sm text-muted-foreground",e),...r}));E.displayName="CardDescription";const k=f.forwardRef(({className:e,...r},t)=>n.jsx("div",{ref:t,className:y("p-6 pt-0",e),...r}));k.displayName="CardContent";const q=f.forwardRef(({className:e,...r},t)=>n.jsx("div",{ref:t,className:y("flex items-center p-6 pt-0",e),...r}));q.displayName="CardFooter";function W(){const[e,r]=f.useState(!1),[t,s]=f.useState({email:"",password:"",name:""}),[a,c]=f.useState(!1),{signUp:v,signIn:o,signInWithGoogle:d,error:i}=z();f.useEffect(()=>{sessionStorage.removeItem("gymbuddy_splash_shown")},[]);const l=async u=>{u.preventDefault(),c(!0);try{e?await v(t.email,t.password,t.name):(console.log("Attempting sign in..."),await o(t.email,t.password),console.log("Sign in completed"))}catch(p){console.error("Sign in error:",p)}finally{c(!1)}},m=async()=>{c(!0);try{await d()}catch{}finally{c(!1)}};return n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background px-4",children:n.jsxs(A,{className:"w-full max-w-md",children:[n.jsxs(P,{className:"text-center",children:[n.jsx(U,{className:"text-2xl",children:"💪 GymBuddy"}),n.jsx(E,{children:e?"Create your account":"Sign in to your account"})]}),n.jsxs(k,{className:"space-y-4",children:[n.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e&&n.jsx("div",{children:n.jsx(w,{type:"text",placeholder:"Full name",value:t.name,onChange:u=>s(p=>({...p,name:u.target.value})),required:!0})}),n.jsx("div",{children:n.jsx(w,{type:"email",placeholder:"Email",value:t.email,onChange:u=>s(p=>({...p,email:u.target.value})),required:!0})}),n.jsx("div",{children:n.jsx(w,{type:"password",placeholder:"Password",value:t.password,onChange:u=>s(p=>({...p,password:u.target.value})),required:!0,minLength:6})}),i&&n.jsx("div",{className:"text-sm text-destructive text-center",children:i}),n.jsx(b,{type:"submit",className:"w-full",disabled:a,children:a?"Loading...":e?"Sign Up":"Sign In"})]}),n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute inset-0 flex items-center",children:n.jsx("span",{className:"w-full border-t"})}),n.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:n.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),n.jsxs(b,{variant:"outline",className:"w-full",onClick:m,disabled:a,children:[n.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 24 24",children:[n.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),n.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),n.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),n.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),"Continue with Google"]}),n.jsxs("div",{className:"text-center text-sm",children:[e?"Already have an account?":"Don't have an account?"," ",n.jsx("button",{type:"button",className:"text-primary underline",onClick:()=>r(!e),children:e?"Sign in":"Sign up"})]})]})]})})}export{W as A,b as B,A as C,P as a,U as b,y as c,E as d,k as e,F as f,g as s,M as t,z as u};
