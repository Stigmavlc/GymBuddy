var c=Object.defineProperty;var d=(i,e,t)=>e in i?c(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var s=(i,e,t)=>d(i,typeof e!="symbol"?e+"":e,t);import{g}from"./index-yXSIh_5C.js";class m{constructor(){s(this,"gapi",null);s(this,"isGoogleCalendarReady",!1)}getConfig(){return{googleClientId:"42291494095-f7lij115hh9gs280ui65js2kib4r3tj4.apps.googleusercontent.com",googleClientSecret:"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",googleApiKey:"AIzaSyC3wgcN8E3ngs5fbAyPY5YBUhhY3hGF7xM"}}async initializeGoogleCalendar(){const e=this.getConfig();if(!e.googleClientId||!e.googleApiKey)return console.log("Google Calendar credentials not configured"),!1;try{return window.gapi||await this.loadGoogleAPIScript(),this.gapi=window.gapi,await this.gapi.load("client:auth2",async()=>{await this.gapi.client.init({apiKey:e.googleApiKey,clientId:e.googleClientId,discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],scope:"https://www.googleapis.com/auth/calendar.events"})}),this.isGoogleCalendarReady=!0,!0}catch(t){return console.error("Failed to initialize Google Calendar:",t),!1}}loadGoogleAPIScript(){return new Promise((e,t)=>{if(document.querySelector('script[src*="apis.google.com"]')){e();return}const a=document.createElement("script");a.src="https://apis.google.com/js/api.js",a.onload=()=>e(),a.onerror=()=>t(new Error("Failed to load Google API script")),document.head.appendChild(a)})}async isGoogleSignedIn(){if(this.isGoogleCalendarReady||await this.initializeGoogleCalendar(),!this.gapi)return!1;const e=this.gapi.auth2.getAuthInstance();return e&&e.isSignedIn.get()}async signInToGoogle(){if(!this.isGoogleCalendarReady&&!await this.initializeGoogleCalendar())return!1;try{return await this.gapi.auth2.getAuthInstance().signIn(),!0}catch(e){return console.error("Google sign-in failed:",e),!1}}async createGoogleCalendarEvent(e,t,a="Partner"){try{if(!await this.isGoogleSignedIn()&&!await this.signInToGoogle())throw new Error("Google Calendar authentication required");const o=this.convertSessionToCalendarEvent(e,t,a);return(await this.gapi.client.calendar.events.insert({calendarId:"primary",resource:{summary:o.summary,description:o.description,start:{dateTime:o.startDateTime,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},end:{dateTime:o.endDateTime,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},location:o.location,attendees:o.attendees,reminders:{useDefault:!1,overrides:[{method:"popup",minutes:30},{method:"email",minutes:60}]}}})).result.id}catch(n){return console.error("Failed to create Google Calendar event:",n),null}}convertSessionToCalendarEvent(e,t,a){const n=(o,r)=>{const l=new Date(o);return l.setHours(r,0,0,0),l.toISOString()};return{id:e.id,summary:`üí™ Gym Session with ${a}`,description:`GymBuddy workout session

Time: ${this.formatTime(e.startTime)} - ${this.formatTime(e.endTime)}

Don't forget to bring:
‚Ä¢ Water bottle
‚Ä¢ Gym clothes  
‚Ä¢ Good energy!

Created by GymBuddy App`,startDateTime:n(e.date,e.startTime),endDateTime:n(e.date,e.endTime),location:"Gym",attendees:[{email:t,displayName:a}]}}formatTime(e){const t=e>=12?"PM":"AM";return`${e===0?12:e>12?e-12:e}:00 ${t}`}async createAppleCalendarEvent(e,t="Partner"){try{const a=g(e,t),n=new Blob([a],{type:"text/calendar;charset=utf-8"}),o=URL.createObjectURL(n),r=document.createElement("a");return r.href=o,r.download=`gym-session-${e.date.toISOString().split("T")[0]}.ics`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o),!0}catch(a){return console.error("Failed to create Apple Calendar event:",a),!1}}async createCalendarEvents(e,t,a="Partner"){const n={google:null,apple:!1};try{n.google=await this.createGoogleCalendarEvent(e,t,a)}catch(o){console.error("Google Calendar creation failed:",o)}try{n.apple=await this.createAppleCalendarEvent(e,a)}catch(o){console.error("Apple Calendar creation failed:",o)}return n}async sendCalendarInvitation(e,t,a){try{const n=encodeURIComponent(`üí™ Gym Session Invitation - ${this.formatTime(e.startTime)}`),o=encodeURIComponent(`Hi ${a}!

You've been invited to a gym session:

üìÖ Date: ${e.date.toLocaleDateString()}
‚è∞ Time: ${this.formatTime(e.startTime)} - ${this.formatTime(e.endTime)}
üìç Location: Gym

The calendar event is attached. You can also manually add this to your calendar.

See you at the gym! üí™

- GymBuddy`),r=`mailto:${t}?subject=${n}&body=${o}`;return window.open(r),!0}catch(n){return console.error("Failed to send calendar invitation:",n),!1}}async deleteGoogleCalendarEvent(e){try{return await this.isGoogleSignedIn()?(await this.gapi.client.calendar.events.delete({calendarId:"primary",eventId:e}),!0):!1}catch(t){return console.error("Failed to delete Google Calendar event:",t),!1}}isGoogleCalendarAvailable(){const e=this.getConfig();return!!(e.googleClientId&&e.googleApiKey)}async testCalendarIntegration(){const e={google:!1,apple:!0,email:!0};try{this.isGoogleCalendarAvailable()&&(e.google=await this.initializeGoogleCalendar())}catch(t){console.error("Google Calendar test failed:",t)}return e}}const h=new m;export{h as calendarService};
