import{j as o,S as T}from"./ui-vendor-BkC7JKse.js";import{r as f}from"./react-vendor-Bxu37LRh.js";import{c as I,t as O}from"./utils-vendor-BPxHO2rW.js";import{c as G}from"./supabase-vendor-2z3JYExL.js";const x="https://your-project.supabase.co",b="your_anon_key",g=G(x,b),H=async()=>{try{console.log("🔍 Testing Supabase connection..."),console.log("📡 URL:",x),console.log("🔑 Key:",b?.substring(0,20)+"...");const e=Date.now(),{data:r,error:t}=await g.from("users").select("count(*)").limit(1),s=Date.now();return console.log(`⏱️  Query took ${s-e}ms`),t?(console.error("❌ Connection test failed:",t),console.error("📋 Error details:",{message:t.message,code:t.code,details:t.details,hint:t.hint}),{success:!1,error:t}):(console.log("✅ Connection test successful:",r),{success:!0,error:null})}catch(e){return console.error("💥 Connection test exception:",e),{success:!1,error:e}}},$=()=>{console.log("🔐 Authentication Debug Info:"),console.log("📡 Supabase URL:",x),console.log("🔑 Has Anon Key:",!0),console.log("🌐 Environment:","production"),console.log("🔧 User Agent:",navigator.userAgent),console.log("📍 Origin:",window.location.origin),fetch(`${x}/rest/v1/`,{headers:{apikey:b,Authorization:`Bearer ${b}`}}).then(e=>{console.log("🌐 Direct Supabase ping response:",e.status,e.statusText)}).catch(e=>{console.error("💥 Direct Supabase ping failed:",e)})},p={async signUp(e,r,t){if(!["ivanaguilarmari@gmail.com","youssef.dummy@test.com"].includes(e.toLowerCase()))throw new Error("This app is currently limited to Ivan and Youssef only. Contact Ivan if you need access.");const{data:a,error:n}=await g.auth.signUp({email:e,password:r,options:{data:{name:t}}});if(n)throw n;return a},async signIn(e,r){if(console.log("🔐 authService.signIn called with:",e),!["ivanaguilarmari@gmail.com","youssef.dummy@test.com"].includes(e.toLowerCase()))throw new Error("This app is currently limited to Ivan and Youssef only. Contact Ivan if you need access.");try{console.log("📡 Attempting Supabase authentication...");const s=Date.now(),{data:a,error:n}=await g.auth.signInWithPassword({email:e,password:r}),h=Date.now();if(console.log(`⏱️  Authentication took ${h-s}ms`),console.log("📋 Supabase signIn response:",{data:a?{user:a.user?{id:a.user.id,email:a.user.email,confirmed_at:a.user.confirmed_at}:null,session:a.session?{access_token:a.session.access_token?.substring(0,20)+"...",expires_at:a.session.expires_at}:null}:null,error:n?{name:n.name,message:n.message,status:n.status,code:n.code}:null}),n)throw console.error("❌ Authentication failed:",{name:n.name,message:n.message,status:n.status,code:n.code,details:n.details}),n;return console.log("✅ Authentication successful"),a}catch(s){throw console.error("💥 authService.signIn error:",s),console.error("🔍 Error type:",typeof s),console.error("🔍 Error properties:",Object.getOwnPropertyNames(s)),s}},async signInWithGoogle(){const{data:e,error:r}=await g.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/auth/callback`}});if(r)throw r;return e},async signOut(){const{error:e}=await g.auth.signOut();if(e)throw e},async getSession(){const{data:{session:e},error:r}=await g.auth.getSession();if(r)throw r;return e},async getUser(){const{data:{user:e},error:r}=await g.auth.getUser();if(r)throw r;return e},onAuthStateChange(e){return g.auth.onAuthStateChange(e)},async createUserProfile(e){console.log("Creating user profile for:",e.email);const r={id:e.id,email:e.email,name:e.user_metadata?.name||e.email.split("@")[0],avatar:e.user_metadata?.avatar_url,preferences:{notifications:{sms:!0,push:!0,reminder_time:30}},stats:{total_sessions:0,current_streak:0,badges:[]}};try{const t=new Promise((h,i)=>setTimeout(()=>i(new Error("Database insert timeout")),3e3)),s=g.from("users").insert(r).select().single(),{data:a,error:n}=await Promise.race([s,t]);if(console.log("createUserProfile result:",{data:a,error:n}),n)return console.error("Failed to create user profile in database:",n),{id:e.id,email:e.email,name:e.user_metadata?.name||e.email.split("@")[0],avatar:e.user_metadata?.avatar_url,partnerId:void 0,preferences:{notifications:{sms:!0,push:!0,reminderTime:30}},stats:{totalSessions:0,currentStreak:0,badges:[]}};if(!a)throw new Error("Failed to create user profile - no data returned");return{id:a.id,email:a.email,name:a.name,avatar:a.avatar,phoneNumber:a.phone_number,partnerId:a.partner_id,preferences:{notifications:{sms:a.preferences?.notifications?.sms??!0,push:a.preferences?.notifications?.push??!0,reminderTime:a.preferences?.notifications?.reminder_time??30}},stats:{totalSessions:a.stats?.total_sessions??0,currentStreak:a.stats?.current_streak??0,badges:a.stats?.badges??[]}}}catch(t){return console.error("createUserProfile error:",t),{id:e.id,email:e.email,name:e.user_metadata?.name||e.email.split("@")[0],avatar:e.user_metadata?.avatar_url,partnerId:void 0,preferences:{notifications:{sms:!0,push:!0,reminderTime:30}},stats:{totalSessions:0,currentStreak:0,badges:[]}}}},async getUserProfile(e){console.log("getUserProfile called for userId:",e);try{const r=new Promise((h,i)=>setTimeout(()=>i(new Error("Database query timeout")),3e3)),t=g.from("users").select("*").eq("id",e).maybeSingle(),{data:s,error:a}=await Promise.race([t,r]);if(console.log("getUserProfile result:",{data:s,error:a}),console.log("Data details:",s),a)return console.error("Database error:",a),null;if(!s)return console.log("No user profile found - will create one"),null;console.log("Found user profile, converting to camelCase...");const n={id:s.id,email:s.email,name:s.name,avatar:s.avatar,phoneNumber:s.phone_number,partnerId:s.partner_id,preferences:{notifications:{sms:s.preferences?.notifications?.sms??!0,push:s.preferences?.notifications?.push??!0,reminderTime:s.preferences?.notifications?.reminder_time??30}},stats:{totalSessions:s.stats?.total_sessions??0,currentStreak:s.stats?.current_streak??0,badges:s.stats?.badges??[]}};return console.log("Converted profile:",n),n}catch(r){return console.error("getUserProfile error:",r),null}},async updateUserProfile(e,r){const t={updated_at:new Date().toISOString()};r.name!==void 0&&(t.name=r.name),r.avatar!==void 0&&(t.avatar=r.avatar),r.phoneNumber!==void 0&&(t.phone_number=r.phoneNumber),r.partnerId!==void 0&&(t.partner_id=r.partnerId),r.preferences!==void 0&&(t.preferences=r.preferences),r.stats!==void 0&&(t.stats=r.stats);const{data:s,error:a}=await g.from("users").update(t).eq("id",e).select().single();if(a)throw a;return{id:s.id,email:s.email,name:s.name,avatar:s.avatar,phoneNumber:s.phone_number,partnerId:s.partner_id,preferences:s.preferences,stats:s.stats}}};function F(){const[e,r]=f.useState({user:null,profile:null,loading:!0,error:null});return f.useEffect(()=>{let i=!0;(async()=>{try{const c=await p.getSession();if(!i)return;if(c?.user){const m=await p.getUserProfile(c.user.id);if(!i)return;r({user:c.user,profile:m,loading:!1,error:null})}else r({user:null,profile:null,loading:!1,error:null})}catch(c){if(console.error("Auth error:",c),!i)return;r({user:null,profile:null,loading:!1,error:c instanceof Error?c.message:"An error occurred"})}})();const{data:{subscription:l}}=p.onAuthStateChange(async(c,m)=>{if(console.log("Auth state changed:",c,m?.user?.email),!!i)try{if(m?.user){console.log("Auth listener: Getting profile for user...");let u=await p.getUserProfile(m.user.id);console.log("Auth listener: Got profile:",u),!u&&c==="SIGNED_IN"&&(console.log("Creating new user profile..."),u=await p.createUserProfile(m.user)),console.log("Auth listener: Setting state with user and profile"),r({user:m.user,profile:u,loading:!1,error:null}),console.log("Auth listener: State updated successfully")}else console.log("Auth listener: No user, clearing state"),r({user:null,profile:null,loading:!1,error:null})}catch(u){console.error("Auth state change error:",u),r({user:null,profile:null,loading:!1,error:u instanceof Error?u.message:"An error occurred"})}});return()=>{i=!1,l.unsubscribe()}},[]),{...e,signUp:async(i,d,l)=>{r(c=>({...c,loading:!0,error:null}));try{await p.signUp(i,d,l)}catch(c){throw r(m=>({...m,loading:!1,error:c instanceof Error?c.message:"Sign up failed"})),c}},signIn:async(i,d)=>{console.log("useAuth signIn called");try{const l=await p.signIn(i,d);console.log("Sign in result:",l)}catch(l){throw console.error("useAuth signIn error:",l),r(c=>({...c,loading:!1,error:l instanceof Error?l.message:"Sign in failed"})),l}},signInWithGoogle:async()=>{r(i=>({...i,loading:!0,error:null}));try{await p.signInWithGoogle()}catch(i){throw r(d=>({...d,loading:!1,error:i instanceof Error?i.message:"Google sign in failed"})),i}},signOut:async()=>{r(i=>({...i,loading:!0,error:null}));try{await p.signOut()}catch(i){throw r(d=>({...d,loading:!1,error:i instanceof Error?i.message:"Sign out failed"})),i}},updateProfile:async i=>{if(!e.user)throw new Error("No user logged in");r(d=>({...d,loading:!0,error:null}));try{const d=await p.updateUserProfile(e.user.id,i);return r(l=>({...l,profile:d,loading:!1,error:null})),d}catch(d){throw r(l=>({...l,loading:!1,error:d instanceof Error?d.message:"Profile update failed"})),d}},isAuthenticated:!!e.user}}const j=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,_=I,R=(e,r)=>t=>{var s;if(r?.variants==null)return _(e,t?.class,t?.className);const{variants:a,defaultVariants:n}=r,h=Object.keys(a).map(l=>{const c=t?.[l],m=n?.[l];if(c===null)return null;const u=j(c)||j(m);return a[l][u]}),i=t&&Object.entries(t).reduce((l,c)=>{let[m,u]=c;return u===void 0||(l[m]=u),l},{}),d=r==null||(s=r.compoundVariants)===null||s===void 0?void 0:s.reduce((l,c)=>{let{class:m,className:u,...v}=c;return Object.entries(v).every(D=>{let[C,S]=D;return Array.isArray(S)?S.includes({...n,...i}[C]):{...n,...i}[C]===S})?[...l,m,u]:l},[]);return _(e,h,d,t?.class,t?.className)};function y(...e){return O(I(e))}const V=R("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),N=f.forwardRef(({className:e,variant:r,size:t,asChild:s=!1,...a},n)=>{const h=s?T:"button";return o.jsx(h,{className:y(V({variant:r,size:t,className:e})),ref:n,...a})});N.displayName="Button";const w=f.forwardRef(({className:e,type:r,...t},s)=>o.jsx("input",{type:r,className:y("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:s,...t}));w.displayName="Input";const A=f.forwardRef(({className:e,...r},t)=>o.jsx("div",{ref:t,className:y("rounded-xl border bg-card text-card-foreground shadow",e),...r}));A.displayName="Card";const P=f.forwardRef(({className:e,...r},t)=>o.jsx("div",{ref:t,className:y("flex flex-col space-y-1.5 p-6",e),...r}));P.displayName="CardHeader";const U=f.forwardRef(({className:e,...r},t)=>o.jsx("div",{ref:t,className:y("font-semibold leading-none tracking-tight",e),...r}));U.displayName="CardTitle";const E=f.forwardRef(({className:e,...r},t)=>o.jsx("div",{ref:t,className:y("text-sm text-muted-foreground",e),...r}));E.displayName="CardDescription";const k=f.forwardRef(({className:e,...r},t)=>o.jsx("div",{ref:t,className:y("p-6 pt-0",e),...r}));k.displayName="CardContent";const B=f.forwardRef(({className:e,...r},t)=>o.jsx("div",{ref:t,className:y("flex items-center p-6 pt-0",e),...r}));B.displayName="CardFooter";function M(){const[e,r]=f.useState(!1),[t,s]=f.useState({email:"",password:"",name:""}),[a,n]=f.useState(!1),{signUp:h,signIn:i,signInWithGoogle:d,error:l}=F();f.useEffect(()=>{sessionStorage.removeItem("gymbuddy_splash_shown")},[]);const c=async u=>{u.preventDefault(),n(!0);try{e?await h(t.email,t.password,t.name):(console.log("Attempting sign in..."),await i(t.email,t.password),console.log("Sign in completed"))}catch(v){console.error("Sign in error:",v)}finally{n(!1)}},m=async()=>{n(!0);try{await d()}catch{}finally{n(!1)}};return o.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background px-4",children:o.jsxs(A,{className:"w-full max-w-md",children:[o.jsxs(P,{className:"text-center",children:[o.jsx(U,{className:"text-2xl",children:"💪 GymBuddy"}),o.jsx(E,{children:e?"Create your account":"Sign in to your account"})]}),o.jsxs(k,{className:"space-y-4",children:[o.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e&&o.jsx("div",{children:o.jsx(w,{type:"text",placeholder:"Full name",value:t.name,onChange:u=>s(v=>({...v,name:u.target.value})),required:!0})}),o.jsx("div",{children:o.jsx(w,{type:"email",placeholder:"Email",value:t.email,onChange:u=>s(v=>({...v,email:u.target.value})),required:!0})}),o.jsx("div",{children:o.jsx(w,{type:"password",placeholder:"Password",value:t.password,onChange:u=>s(v=>({...v,password:u.target.value})),required:!0,minLength:6})}),l&&o.jsx("div",{className:"text-sm text-destructive text-center",children:l}),o.jsx(N,{type:"submit",className:"w-full",disabled:a,children:a?"Loading...":e?"Sign Up":"Sign In"})]}),o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"absolute inset-0 flex items-center",children:o.jsx("span",{className:"w-full border-t"})}),o.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:o.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),o.jsxs(N,{variant:"outline",className:"w-full",onClick:m,disabled:a,children:[o.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 24 24",children:[o.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),o.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),o.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),o.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),"Continue with Google"]}),o.jsxs("div",{className:"text-center text-sm",children:[e?"Already have an account?":"Don't have an account?"," ",o.jsx("button",{type:"button",className:"text-primary underline",onClick:()=>r(!e),children:e?"Sign in":"Sign up"})]})]})]})})}export{M as A,N as B,A as C,P as a,U as b,y as c,$ as d,E as e,k as f,R as g,g as s,H as t,F as u};
