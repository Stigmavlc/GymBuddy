import{R as ee,j as e,P as se,C as M,a as te,T as z,O as G,D as O,b as ae,c as ne,d as oe,A as ie,e as re,f as le}from"./ui-vendor-Dh6LInB3.js";import{r as n,u as ce}from"./react-vendor-DWv6uwxK.js";import{c as y,B as m,u as de,s as me,C as x,a as u,b as g,d as h,e as p}from"./auth-DZ3nYzx0.js";import{B}from"./badge-Cvy95V9H.js";import{s as f,b as D}from"./services-DFADvecE.js";import{B as xe}from"./BadgeGrid-DwJtezyx.js";import{a as Y}from"./utils-vendor-BZaDkFqu.js";import"./supabase-vendor-Dgy_jg73.js";function ue(s,a){if(s==null)return{};var t={},o=Object.keys(s),r,i;for(i=0;i<o.length;i++)r=o[i],!(a.indexOf(r)>=0)&&(t[r]=s[r]);return t}var ge=["color"],he=n.forwardRef(function(s,a){var t=s.color,o=t===void 0?"currentColor":t,r=ue(s,ge);return n.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r,{ref:a}),n.createElement("path",{d:"M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z",fill:o,fillRule:"evenodd",clipRule:"evenodd"}))});const pe=ee,fe=se,P=n.forwardRef(({className:s,...a},t)=>e.jsx(G,{ref:t,className:y("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a}));P.displayName=G.displayName;const H=n.forwardRef(({className:s,children:a,...t},o)=>e.jsxs(fe,{children:[e.jsx(P,{}),e.jsxs(M,{ref:o,className:y("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t,children:[a,e.jsxs(te,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));H.displayName=M.displayName;const I=({className:s,...a})=>e.jsx("div",{className:y("flex flex-col space-y-1.5 text-center sm:text-left",s),...a});I.displayName="DialogHeader";const _=n.forwardRef(({className:s,...a},t)=>e.jsx(z,{ref:t,className:y("text-lg font-semibold leading-none tracking-tight",s),...a}));_.displayName=z.displayName;const je=n.forwardRef(({className:s,...a},t)=>e.jsx(O,{ref:t,className:y("text-sm text-muted-foreground",s),...a}));je.displayName=O.displayName;function be({badge:s,isOpen:a,onClose:t}){if(!s)return null;const o=s.category==="long-term",r=["century-club","double-century","triple-digits"].includes(s.id),i=["yearly-legend","dedication-diamond"].includes(s.id),l=i?{bgGradient:"bg-gradient-to-br from-purple-100 via-pink-100 to-orange-100",borderColor:"border-purple-300",textColor:"text-purple-800",icon:e.jsx(ae,{className:"h-8 w-8 text-purple-600"}),celebration:"ðŸŽ‰ðŸ†âœ¨"}:o||r?{bgGradient:"bg-gradient-to-br from-yellow-100 via-orange-100 to-red-100",borderColor:"border-orange-300",textColor:"text-orange-800",icon:e.jsx(ne,{className:"h-8 w-8 text-orange-600"}),celebration:"ðŸŒŸðŸ’ªðŸ”¥"}:{bgGradient:"bg-gradient-to-br from-green-100 via-blue-100 to-purple-100",borderColor:"border-green-300",textColor:"text-green-800",icon:e.jsx(oe,{className:"h-8 w-8 text-green-600"}),celebration:"âœ¨ðŸŽ¯â­"};return e.jsx(pe,{open:a,onOpenChange:j=>!j&&t(),children:e.jsxs(H,{className:`max-w-md ${l.bgGradient} ${l.borderColor} border-2`,children:[e.jsxs(I,{className:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center items-center gap-2 text-4xl animate-bounce",children:l.celebration.split("").map((j,v)=>e.jsx("span",{className:"inline-block",style:{animationDelay:`${v*.1}s`,animationDuration:"1s",animationIterationCount:"3"},children:j},v))}),e.jsx(_,{className:`text-2xl font-bold ${l.textColor}`,children:"Badge Unlocked!"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"text-6xl mb-4 transform animate-pulse",children:s.icon}),e.jsx("div",{className:"absolute -top-2 -right-2",children:l.icon})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl font-bold text-foreground",children:s.name}),e.jsx("p",{className:"text-muted-foreground",children:s.description}),e.jsx(B,{variant:"secondary",className:"mt-2",children:s.category==="long-term"?"Long-term Achievement":s.category==="milestone"?"Major Milestone":s.category.charAt(0).toUpperCase()+s.category.slice(1)})]})]}),e.jsx("div",{className:`text-center p-4 rounded-lg bg-white/50 ${l.textColor}`,children:i?e.jsx("p",{className:"font-semibold",children:"ðŸŽŠ Incredible! You've achieved something truly special! This level of dedication is legendary! ðŸŽŠ"}):o||r?e.jsx("p",{className:"font-semibold",children:"ðŸ”¥ Amazing achievement! Your consistency and dedication are paying off! ðŸ”¥"}):e.jsx("p",{className:"font-semibold",children:"ðŸŽ‰ Great job! You're building some serious momentum! ðŸŽ‰"})}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground bg-white/30 rounded-lg p-3",children:[e.jsx("strong",{children:"Achievement:"})," ",s.criteria]})]}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(m,{onClick:t,className:"px-8",children:"Awesome! ðŸš€"})})]})})}function Be(){const{user:s,profile:a}=de(),t=ce(),[o,r]=n.useState({completed:0,total:0}),[i,A]=n.useState([]),[l,j]=n.useState(0),[v,V]=n.useState(0),[L,T]=n.useState([]),[U,$]=n.useState(null),[b,R]=n.useState(!0),F=()=>{t("/availability")},K=()=>{t("/sessions")},Q=()=>{t("/analytics")};n.useEffect(()=>{if(!s)return;console.log("Dashboard: Setting up real-time subscription for availability changes");const c=me.channel("dashboard-availability-changes").on("postgres_changes",{event:"*",schema:"public",table:"availability"},d=>{console.log("Dashboard: Availability change detected:",d);const w=d.new?.user_id||d.old?.user_id;console.log("Dashboard: Change affects user:",w),Y.info("Availability has been updated",{description:"Refresh to see the latest changes",action:{label:"Refresh",onClick:()=>window.location.reload()}})}).subscribe();return()=>{c.unsubscribe()}},[s]),n.useEffect(()=>{if(!s)return;(async()=>{try{R(!0),await f.updateCompletedSessions(s.id),await f.updateUserStats(s.id);const d=await f.getCurrentWeekSessions(s.id);r({completed:d.completed,total:d.total});const w=await f.getUpcomingSessions(s.id);A(w);const J=await f.calculateStreak(s.id);j(J);const X=await f.getUserSessions(s.id,"completed");V(X.length);const C=await D.checkAndAwardBadges(s.id);C.length>0&&($(C[0].badge),Y.success(`ðŸ† New badge unlocked: ${C[0].badge.name}!`));try{console.log("Dashboard: Starting badge initialization and loading");const N=await D.initializeBadges();console.log("Dashboard: Badge initialization result:",N);const k=await D.getBadgesWithProgress(s.id);console.log("Dashboard: Loaded badges:",{count:k?.length||0,badges:k?.map(S=>({id:S.id,name:S.name,isUnlocked:S.isUnlocked}))||[]}),T(k||[]),console.log("Dashboard: Badge state set successfully")}catch(N){console.error("Dashboard: Error loading badges:",N),console.error("Dashboard: Badge error stack:",N?.stack),T([])}}catch(d){console.error("Error loading dashboard data:",d)}finally{R(!1)}})()},[s]);const W=a?.email==="ivanaguilarmari@gmail.com",Z=!W&&a?.email,q=()=>W?`Welcome back, ${a?.name}! Time to coordinate with Youssef for this week's gym sessions.`:Z?"Hey Youssef! Ivan built this app just for us. Ready to crush some workouts this week? ðŸ’ª":`Welcome, ${a?.name}!`;return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Dashboard"}),e.jsx(B,{variant:"secondary",children:"Week 1"})]}),a&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsx("p",{className:"text-orange-800",children:q()})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:[e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsx(g,{children:"This Week"}),e.jsx(h,{children:"Your workout progress"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:b?"...":`${o.completed}/${o.total||2}`}),e.jsx("p",{className:"text-muted-foreground",children:"Sessions completed"})]})]}),e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsx(g,{children:"Current Streak"}),e.jsx(h,{children:"Consecutive weeks"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:b?"...":`ðŸ”¥ ${l}`}),e.jsx("p",{className:"text-muted-foreground",children:"Keep it up!"})]})]}),e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsx(g,{children:"Total Sessions"}),e.jsx(h,{children:"All time"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:b?"...":v}),e.jsx("p",{className:"text-muted-foreground",children:"Workouts completed"})]})]})]}),e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsx(g,{children:"Quick Actions"}),e.jsx(h,{children:"Get started with GymBuddy"})]}),e.jsx(p,{children:e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(m,{onClick:F,className:"flex-1 min-w-[200px] sm:flex-none justify-start",children:"ðŸ“… Set Availability"}),e.jsx(m,{onClick:K,variant:"secondary",className:"flex-1 min-w-[200px] sm:flex-none justify-start",children:"ðŸ” Find Sessions"}),e.jsx(m,{variant:"outline",onClick:Q,className:"flex-1 min-w-[200px] sm:flex-none justify-start",children:"ðŸ“Š View Stats"}),e.jsxs(m,{variant:"outline",onClick:()=>t("/badges"),className:"flex-1 min-w-[200px] sm:flex-none justify-start",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Badges"]})]})})]}),e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsx(g,{children:"Upcoming Sessions"}),e.jsx(h,{children:"Your scheduled workouts"})]}),e.jsx(p,{children:b?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"Loading..."}):i.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No sessions scheduled yet. Set your availability to get started!"}):e.jsxs("div",{className:"space-y-3",children:[i.slice(0,3).map(c=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"h-4 w-4 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:c.date.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[E(c.startTime)," - ",E(c.endTime)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c.date.toDateString()===new Date().toDateString()&&e.jsx(B,{variant:"secondary",children:"Today"}),e.jsx(le,{className:"h-4 w-4 text-muted-foreground"})]})]},c.id)),i.length>3&&e.jsxs(m,{variant:"ghost",className:"w-full mt-2",onClick:()=>t("/sessions"),children:["View all ",i.length," sessions â†’"]})]})})]}),e.jsxs(x,{children:[e.jsx(u,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Achievement Badges"}),e.jsx(h,{children:L.length>0?"Your latest accomplishments":"Start achieving milestones to unlock badges!"})]}),e.jsx(m,{variant:"ghost",onClick:()=>t("/badges"),children:"View All â†’"})]})}),e.jsx(p,{children:b?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsx(xe,{badges:L,maxDisplay:4,showProgress:!0})})]}),e.jsx(be,{badge:U,isOpen:!!U,onClose:()=>$(null)})]})}function E(s){const a=s>=12?"PM":"AM";return`${s===0?12:s>12?s-12:s}:00 ${a}`}export{Be as Dashboard};
